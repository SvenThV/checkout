<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart | ShopEasy</title>
    <link rel="stylesheet" href="styles.css"> <!-- Shared CSS file -->
</head>
<body>
    <header>
        <h1>Your Cart</h1>
    </header>

    <main>
        <ul id="cart-list">
            <!-- Dynamic cart items will be inserted here -->
        </ul>
        <button id="checkout-button" class="checkout-button">Proceed to Checkout</button>
    </main>

    <footer class="footer">
        <a href="index.html" class="icon" aria-label="Home">üè†</a>
        <a href="barcode.html" class="icon" aria-label="Scanner">üîç</a>
        <a href="receipts.html" class="icon" aria-label="Receipts">üìÑ</a>
        <a href="cart.html" class="icon" aria-label="Cart">üì¶</a>
        <a href="account.html" class="icon" aria-label="Account">üë§</a>
    </footer>

    <script>
        async function loadCart() {
            try {
                const response = await fetch("http://localhost:5000/api/cart");
                if (!response.ok) throw new Error("Failed to load cart");

                const cart = await response.json();
                const cartList = document.getElementById("cart-list");
                cartList.innerHTML = cart
                    .map(
                        (item) => `
                        <li>
                            <strong>${item.product_name}</strong> - $${parseFloat(item.price).toFixed(2)}
                        </li>`
                    )
                    .join("");
            } catch (error) {
                console.error("Error loading cart:", error);
            }
        }

        async function proceedToCheckout() {
            try {
                const response = await fetch("http://localhost:5000/api/cart/checkout", { method: "POST" });
                if (!response.ok) throw new Error("Checkout failed");

                alert("Checkout successful!");
                document.getElementById("cart-list").innerHTML = ""; // Clear cart display
            } catch (error) {
                console.error("Error during checkout:", error);
            }
        }

        document.getElementById("checkout-button").addEventListener("click", proceedToCheckout);

        document.addEventListener("DOMContentLoaded", loadCart);
    </script>
</body>
</html>